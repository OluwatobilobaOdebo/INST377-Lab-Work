<!DOCTYPE html>
<html lang ='en'>
    <head>
        <meta charset='UTF-8'>
        <title>Oluwatobiloba Odebo: Lab 6</title>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css">
        <link rel="stylesheet" href="styles.css">
    </head>
    <body>
        <div class = "wrapper">
            <div class = "container">
                <div class = "columns">
                    <div class = "column is-full">Oluwatobiloba Odebo's Lab 6</div>
                    <div class = "column is-one-quarter">
                        <form class="form-row">
                            <label for="search"></label>
                            <input type="text" class = "search" placeholder="enter city name">
                            <ul class= "suggestions"></ul>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <script>

            async function windowsAction(){

            const request = await fetch('https://data.princegeorgescountymd.gov/resource/umjn-t2iz.json');

            const cities = await request.json();

            function findMatches(wordToMatch, cities){
                return cities.filter(place => {

                    const regex = new RegExp(wordToMatch, 'gi');
                    return place.city.match(regex);
                })
            }

            const searchInput = document.querySelector('.search');
            const suggestions = document.querySelector('.suggestions');

            searchInput.addEventListener('change', displayMatches);
            searchInput.addEventListener('keyup', (evt) => { 

                if(!evt.target.value){
                    suggestions.innerHTML = '';
                } else {
                    displayMatches(evt);
                }
                }); 

                function numberWithCommas(x){
                    return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
                }

                function displayMatches(event){
                    const matchArray = findMatches(event.target.value, cities);
                    const html = matchArray.map(place => {
                        return `
                        <ul>
                        <li><div class = "name">${place.name}</div></li>
                        <div class = "category">${place.category}</div>
                        <div class = "address">${place.address_line_1}</div>
                        <div class = "city">${place.city}</div>
                        <div class = "zip">${place.zip}</div>
                        </ul>
                        <br>,
                        `;
                    }).join('');
                    suggestions.innerHTML = html;
                }

                console.log(data);
            }

            window.onload = windowsAction;
        </script>
    </body>
</html>